import{c as e,m as g,I as x,d as S,a as C,o as N,b as E,t as m,i as r,S as $,u as T,e as R,f as k,g as M,F as j,h as z,s as I,j as L}from"./index-J60QlFfz.js";var V=[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["line",{x1:"12",x2:"12",y1:"8",y2:"12",key:"1pkeuh"}],["line",{x1:"12",x2:"12.01",y1:"16",y2:"16",key:"4dfq90"}]],A=t=>e(x,g(t,{name:"CircleAlert",iconNode:V})),W=A,O=[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}]],q=t=>e(x,g(t,{name:"Circle",iconNode:O})),D=q,H=[["circle",{cx:"12",cy:"12",r:"1",key:"41hilf"}],["circle",{cx:"12",cy:"5",r:"1",key:"gxeob9"}],["circle",{cx:"12",cy:"19",r:"1",key:"lyex9k"}]],P=t=>e(x,g(t,{name:"EllipsisVertical",iconNode:H})),F=P,X=[["path",{d:"m21 21-6-6m6 6v-4.8m0 4.8h-4.8",key:"1c15vz"}],["path",{d:"M3 16.2V21m0 0h4.8M3 21l6-6",key:"1fsnz2"}],["path",{d:"M21 7.8V3m0 0h-4.8M21 3l-6 6",key:"hawz9i"}],["path",{d:"M3 7.8V3m0 0h4.8M3 3l6 6",key:"u9ee12"}]],B=t=>e(x,g(t,{name:"Expand",iconNode:X})),G=B,J=[["path",{d:"M12 2v4",key:"3427ic"}],["path",{d:"m16.2 7.8 2.9-2.9",key:"r700ao"}],["path",{d:"M18 12h4",key:"wj9ykh"}],["path",{d:"m16.2 16.2 2.9 2.9",key:"1bxg5t"}],["path",{d:"M12 18v4",key:"jadmvz"}],["path",{d:"m4.9 19.1 2.9-2.9",key:"bwix9q"}],["path",{d:"M2 12h4",key:"j09sii"}],["path",{d:"m4.9 4.9 2.9 2.9",key:"giyufr"}]],U=t=>e(x,g(t,{name:"Loader",iconNode:J})),K=U,Q=[["polyline",{points:"15 3 21 3 21 9",key:"mznyad"}],["polyline",{points:"9 21 3 21 3 15",key:"1avn1i"}],["line",{x1:"21",x2:"14",y1:"3",y2:"10",key:"ota7mn"}],["line",{x1:"3",x2:"10",y1:"21",y2:"14",key:"1atl0r"}]],Y=t=>e(x,g(t,{name:"Maximize2",iconNode:Q})),Z=Y,ee=[["path",{d:"M11 4.702a.705.705 0 0 0-1.203-.498L6.413 7.587A1.4 1.4 0 0 1 5.416 8H3a1 1 0 0 0-1 1v6a1 1 0 0 0 1 1h2.416a1.4 1.4 0 0 1 .997.413l3.383 3.384A.705.705 0 0 0 11 19.298z",key:"uqj9uw"}],["path",{d:"M16 9a5 5 0 0 1 0 6",key:"1q6k2b"}],["path",{d:"M19.364 18.364a9 9 0 0 0 0-12.728",key:"ijwkga"}]],te=t=>e(x,g(t,{name:"Volume2",iconNode:ee})),ae=te,le=[["path",{d:"M11 4.702a.705.705 0 0 0-1.203-.498L6.413 7.587A1.4 1.4 0 0 1 5.416 8H3a1 1 0 0 0-1 1v6a1 1 0 0 0 1 1h2.416a1.4 1.4 0 0 1 .997.413l3.383 3.384A.705.705 0 0 0 11 19.298z",key:"uqj9uw"}],["line",{x1:"22",x2:"16",y1:"9",y2:"15",key:"1ewh16"}],["line",{x1:"16",x2:"22",y1:"9",y2:"15",key:"5ykzw1"}]],re=t=>e(x,g(t,{name:"VolumeX",iconNode:le})),se=re,ne=[["path",{d:"M12 20h.01",key:"zekei9"}],["path",{d:"M8.5 16.429a5 5 0 0 1 7 0",key:"1bycff"}],["path",{d:"M5 12.859a10 10 0 0 1 5.17-2.69",key:"1dl1wf"}],["path",{d:"M19 12.859a10 10 0 0 0-2.007-1.523",key:"4k23kn"}],["path",{d:"M2 8.82a15 15 0 0 1 4.177-2.643",key:"1grhjp"}],["path",{d:"M22 8.82a15 15 0 0 0-11.288-3.764",key:"z3jwby"}],["path",{d:"m2 2 20 20",key:"1ooewy"}]],ie=t=>e(x,g(t,{name:"WifiOff",iconNode:ne})),oe=ie;S(["click","input"]);var ce=m('<div class="absolute inset-0 flex flex-col items-center justify-center bg-slate-900/90"><span class="text-sm text-slate-400">Conectando stream...'),de=m('<div class="absolute inset-0 flex flex-col items-center justify-center bg-slate-900/90"><span class="text-sm text-slate-400">Stream desconectado</span><button class="mt-3 px-4 py-2 bg-vms-primary rounded-lg text-sm hover:bg-vms-primary/80 transition-colors">Reconectar'),ue=m('<div class="absolute inset-0 flex flex-col items-center justify-center bg-slate-900/90"><span class="text-sm text-red-400 mb-1">Erro de conexão</span><span class="text-xs text-slate-500 max-w-xs text-center"></span><button class="mt-3 px-4 py-2 bg-vms-primary rounded-lg text-sm hover:bg-vms-primary/80 transition-colors">Tentar Novamente'),me=m('<div class="absolute top-2 right-2"><div class="flex items-center gap-1.5 px-2 py-1 bg-green-500/20 rounded-full border border-green-500/30"><div class="w-2 h-2 bg-green-500 rounded-full animate-pulse"></div><span class="text-xs text-green-400 font-medium">LIVE'),he=m('<div class="relative w-full h-full bg-black"><video autoplay muted playsinline class="w-full h-full object-contain">');const fe=t=>{let v,o=null,f=null;const[y,p]=C("connecting"),[u,n]=C(""),i=()=>{o&&(o.close(),o=null),f&&(fetch(`http://localhost:9094/stream/${f}`,{method:"DELETE"}).catch(console.error),f=null)},d=async()=>{try{p("connecting"),n(""),o=new RTCPeerConnection({iceServers:[{urls:"stun:stun.l.google.com:19302"},{urls:"stun:stun1.l.google.com:19302"}]}),o.ontrack=l=>{console.log("WebRTC: Track received",l.streams[0]),v&&l.streams[0]&&(v.srcObject=l.streams[0],p("connected"),t.onConnected?.())},o.onconnectionstatechange=()=>{const l=o?.connectionState;console.log("WebRTC: Connection state:",l),l==="connected"?p("connected"):l==="disconnected"||l==="closed"?p("disconnected"):l==="failed"&&(p("error"),n("Conexão falhou"))},o.oniceconnectionstatechange=()=>{const l=o?.iceConnectionState;console.log("WebRTC: ICE state:",l)};const a=await o.createOffer({offerToReceiveVideo:!0,offerToReceiveAudio:!0});await o.setLocalDescription(a);const c=await fetch("http://localhost:9094/stream",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({camera_id:t.cameraId,sdp:a.sdp,type:a.type})});if(!c.ok){const l=await c.text();throw new Error(`Falha ao criar stream: ${l}`)}const h=await c.json();f=h.stream_id;const{answer:s}=h;await o.setRemoteDescription(new RTCSessionDescription({type:"answer",sdp:s})),console.log("WebRTC: Connection established, stream_id:",f)}catch(a){console.error("WebRTC: Connection error:",a),p("error"),n(a.message),t.onError?.(a)}};return N(()=>{d()}),E(()=>{i()}),(()=>{var a=he(),c=a.firstChild,h=v;return typeof h=="function"?T(h,c):v=c,r(a,e($,{get when(){return y()==="connecting"},get children(){var s=ce(),l=s.firstChild;return r(s,e(K,{class:"w-12 h-12 text-vms-accent animate-spin mb-3"}),l),s}}),null),r(a,e($,{get when(){return y()==="disconnected"},get children(){var s=de(),l=s.firstChild,_=l.nextSibling;return r(s,e(oe,{class:"w-12 h-12 text-slate-500 mb-3"}),l),_.$$click=d,s}}),null),r(a,e($,{get when(){return y()==="error"},get children(){var s=ue(),l=s.firstChild,_=l.nextSibling,b=_.nextSibling;return r(s,e(W,{class:"w-12 h-12 text-red-500 mb-3"}),l),r(_,u),b.$$click=d,s}}),null),r(a,e($,{get when(){return y()==="connected"},get children(){return me()}}),null),a})()};S(["click"]);var pe=m("<div>"),ge=m('<div class="absolute inset-0 flex flex-col items-center justify-center text-slate-600"><span class=text-sm>Sem câmera'),xe=m('<div class="absolute inset-0">'),ve=m('<div class="flex items-center gap-1 text-red-400 text-xs"><span>REC'),ye=m('<div class="absolute top-0 left-0 right-0 p-2 bg-gradient-to-b from-black/70 to-transparent"><div class="flex items-center justify-between"><div class="flex items-center gap-2"><span></span><span class="text-white text-sm font-medium truncate">'),be=m('<div class="absolute bottom-0 left-0 right-0 p-2 bg-gradient-to-t from-black/70 to-transparent"><div class="flex items-center justify-between text-xs text-slate-300"><span> @ <!>fps</span><span>'),$e=m('<div class="absolute inset-0 bg-black/40 flex items-center justify-center gap-3 animate-fadeIn"><button class="p-2 bg-white/20 hover:bg-white/30 rounded-full transition-colors"title="Tela cheia"></button><button class="p-2 bg-white/20 hover:bg-white/30 rounded-full transition-colors"></button><button class="p-2 bg-white/20 hover:bg-white/30 rounded-full transition-colors"title="Mais opções">'),_e=m('<div class="h-full flex flex-col"><div class="flex items-center justify-between p-3 bg-slate-800/50 border-b border-slate-700"><div class="flex items-center gap-2"><span class="text-sm text-slate-400 mr-2">Layout:</span><div class="flex items-center bg-slate-900 rounded-lg p-1"></div></div><div class="flex items-center gap-2"><button class="btn btn-ghost flex items-center gap-2 text-sm">Tela Cheia</button></div></div><div class="flex-1 p-3 overflow-auto"><div>'),we=m("<button>");const ke=[{type:"1x1",label:"1",cols:1},{type:"2x2",label:"4",cols:2},{type:"3x3",label:"9",cols:3},{type:"4x4",label:"16",cols:4}],Ce=t=>{const[v,o]=C(!1),[f,y]=C(!0),p=()=>{const u=["from-blue-900/40 to-slate-900","from-purple-900/40 to-slate-900","from-cyan-900/40 to-slate-900","from-emerald-900/40 to-slate-900"];return u[t.index%u.length]};return(()=>{var u=pe();return u.addEventListener("mouseleave",()=>o(!1)),u.addEventListener("mouseenter",()=>o(!0)),r(u,e($,{get when(){return t.camera},get fallback(){return(()=>{var n=ge(),i=n.firstChild;return r(n,e(L,{class:"w-12 h-12 mb-2"}),i),n})()},children:n=>[(()=>{var i=xe();return r(i,e(fe,{get cameraId(){return n().id},onError:d=>console.error("Stream error:",n().name,d),onConnected:()=>console.log("Stream connected:",n().name)})),i})(),(()=>{var i=ye(),d=i.firstChild,a=d.firstChild,c=a.firstChild,h=c.nextSibling;return r(h,()=>n().name),r(d,e($,{get when(){return n().recording},get children(){var s=ve(),l=s.firstChild;return r(s,e(D,{class:"w-2 h-2 fill-current animate-pulse"}),l),s}}),null),k(()=>M(c,`w-2 h-2 rounded-full ${n().status==="online"?"bg-green-500":"bg-red-500"}`)),i})(),(()=>{var i=be(),d=i.firstChild,a=d.firstChild,c=a.firstChild,h=c.nextSibling;h.nextSibling;var s=a.nextSibling;return r(a,()=>n().resolution,c),r(a,()=>n().fps,h),r(s,()=>n().codec.toUpperCase()),i})(),e($,{get when(){return v()},get children(){var i=$e(),d=i.firstChild,a=d.nextSibling,c=a.nextSibling;return r(d,e(G,{class:"w-5 h-5 text-white"})),a.$$click=()=>y(!f()),r(a,e($,{get when(){return f()},get fallback(){return e(ae,{class:"w-5 h-5 text-white"})},get children(){return e(se,{class:"w-5 h-5 text-white"})}})),r(c,e(F,{class:"w-5 h-5 text-white"})),k(()=>I(a,"title",f()?"Ativar áudio":"Desativar áudio")),i}})]})),k(()=>M(u,`
        relative bg-gradient-to-br ${p()} 
        border border-slate-700 rounded-lg overflow-hidden 
        camera-cell cursor-pointer group
      `)),u})()},Se=()=>{const{state:t,actions:v}=R(),{loadCameras:o,setLayout:f,getCameraById:y}=v;N(()=>{o()});const p=()=>{switch(t.layout){case"1x1":return"grid-cols-1";case"2x2":return"grid-cols-2";case"3x3":return"grid-cols-3";case"4x4":return"grid-cols-4";default:return"grid-cols-2"}};return(()=>{var u=_e(),n=u.firstChild,i=n.firstChild,d=i.firstChild,a=d.nextSibling,c=i.nextSibling,h=c.firstChild,s=h.firstChild,l=n.nextSibling,_=l.firstChild;return r(a,e(j,{each:ke,children:b=>(()=>{var w=we();return w.$$click=()=>f(b.type),r(w,()=>b.label),k(()=>M(w,`
                    px-3 py-1.5 rounded-md text-sm font-medium transition-all
                    ${t.layout===b.type?"bg-vms-primary text-white":"text-slate-400 hover:text-white hover:bg-slate-700"}
                  `)),w})()})),r(h,e(Z,{class:"w-4 h-4"}),s),r(_,e(j,{get each(){return t.gridCells},children:(b,w)=>e(Ce,{get camera(){return z(()=>!!b.cameraId)()?y(b.cameraId):void 0},get index(){return w()}})})),k(()=>M(_,`grid ${p()} gap-3 h-full`)),u})()};S(["click"]);export{Se as default};
